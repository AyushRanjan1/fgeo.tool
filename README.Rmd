---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# fgeo.utils: Utility functions of ForestGEO <img src="https://i.imgur.com/39pvr4n.png" align="right" height=44 />

[![Travis build status](https://travis-ci.org/forestgeo/fgeo.utils.svg?branch=master)](https://travis-ci.org/forestgeo/fgeo.utils)
[![Coverage status](https://coveralls.io/repos/github/forestgeo/fgeo.utils/badge.svg)](https://coveralls.io/r/forestgeo/fgeo.utils?branch=master)
[![CRAN status](http://www.r-pkg.org/badges/version/fgeo.utils)](https://cran.r-project.org/package=fgeo.utils)

## Installation

You can install fgeo.utils from github with:

```{r gh-installation, eval = FALSE}
# install.packages("remotes")
remotes::install_github("forestgeo/fgeo.utils")
library(fgeo.utils)
```

## Example

Setup.

```{r example, error=TRUE}
library(fgeo.utils)

df <- tibble::tribble(
  ~CensusID, ~Tag, ~Status,
          1,    1, "alive",
          1,    1,  "dead",
                           
          1,    2,  "dead",
          1,    2,  "dead",
                           
          1,    3,  "dead",
          1,    3,  "dead",
                           
          2,    1, "alive",
          2,    1, "alive",
                           
          2,    2, "alive",
          2,    2,  "dead",
                           
          2,    3,  "dead",
          2,    3,  "dead"
)

```

Manipulate data.

```{r}
# Mutate a data set

# Determine the status of each tree based on the status of its stems
status_tree(df)

# Filter a data set

# Filter from the head or tail of a variable
top(df, Tag)
top(df, Tag, -1)
# Remove trees found dead in two or more censuses
rm_dead_twice(df)
```

Check inputs.

```{r, error=TRUE}
# Silent means success
check_crucial_names(df, "Status")

# Errs if the data hasn't a given name
check_crucial_names(df, "DBH")

check_unique(df, "CensusID", msg = "* Is this what you expect?")
```

Much you can do directly with dplyr.

```{r}
# Using notation dplyr::fun to make it obvious where fun comes from
library(dplyr)

dplyr::filter(
  .data = df,
  CensusID > 1,
  Tag  %in% c(1, 2),
  Status == "alive"
)
```

You can combine __fgeo.utils__ with __dplyr__.

```{r}
edited <- status_tree(top(df, CensusID, -1))
dplyr::select(edited, -Status)
```

You don't have to, but if you want you can use the pipe (` %>% `).

```{r}
# With the pipe
df %>% 
  status_tree() %>%
  dplyr::filter(status_tree == "alive") %>%
  dplyr::rename(status_stem = Status) %>%
  dplyr::arrange(desc(CensusID))

# Same but without the pipe: It is hard to understand what is going on.
dplyr::arrange(
  dplyr::rename(
    dplyr::filter(
      status_tree(df), status_tree == "alive"), 
    status_stem = Status
  ), 
  desc(CensusID)
)
```



